<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@azure/eventhubs-checkpointstore-blob</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@azure/eventhubs-checkpointstore-blob</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1> @azure/eventhubs-checkpointstore-blob</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#azure-event-hubs-checkpoint-store-library-for-javascript-using-storage-blobs" id="azure-event-hubs-checkpoint-store-library-for-javascript-using-storage-blobs" style="color: inherit; text-decoration: none;">
					<h1>Azure Event Hubs Checkpoint Store library for Javascript using Storage Blobs</h1>
				</a>
				<p>An Azure Blob storage based solution to store checkpoints and to aid in load balancing when using <code>EventProcessor</code> from the <a href="https://www.npmjs.com/package/@azure/event-hubs">@azure/event-hubs</a> library</p>
				<p><a href="https://github.com/Azure/azure-sdk-for-js/tree/master/sdk/eventhub/eventhubs-checkpointstore-blob">Source code</a> | <a href="https://www.npmjs.com/package/@azure/eventhubs-checkpointstore-blob">Package (npm)</a> | <a href="https://azure.github.io/azure-sdk-for-js/eventhubs-checkpointstore-blob/index.html">API Reference Documentation</a> | <a href="https://github.com/Azure/azure-sdk-for-js/tree/master/sdk/eventhub/eventhubs-checkpointstore-blob/samples">Samples</a></p>
				<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
					<h2>Getting started</h2>
				</a>
				<a href="#install-the-package" id="install-the-package" style="color: inherit; text-decoration: none;">
					<h3>Install the package</h3>
				</a>
				<p>Install the Azure Event Hubs Checkpoint Store Blob library using npm</p>
				<p><code>npm install @azure/eventhubs-checkpointstore-blob</code></p>
				<p><strong>Prerequisites</strong>: You must have an <a href="https://azure.microsoft.com/free/">Azure subscription</a>, an
				<a href="https://docs.microsoft.com/en-us/azure/event-hubs/">Event Hubs Namespace</a> to use this package, and a <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction">Storage account</a></p>
				<p>If you are using this package in a Node.js application, then use Node.js 8.x or higher.</p>
				<a href="#configure-typescript" id="configure-typescript" style="color: inherit; text-decoration: none;">
					<h3>Configure Typescript</h3>
				</a>
				<p>TypeScript users need to have Node type definitions installed:</p>
				<pre><code class="language-bash">npm install @types/node</code></pre>
				<p>You also need to enable <code>compilerOptions.allowSyntheticDefaultImports</code> in your tsconfig.json. Note that if you have enabled <code>compilerOptions.esModuleInterop</code>, <code>allowSyntheticDefaultImports</code> is enabled by default. See <a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">TypeScript&#39;s compiler options handbook</a> for more information.</p>
				<a href="#key-concepts" id="key-concepts" style="color: inherit; text-decoration: none;">
					<h3>Key concepts</h3>
				</a>
				<ul>
					<li><p><strong>Scale:</strong> Create multiple consumers, with each consumer taking ownership of reading from a few Event Hubs partitions.</p>
					</li>
					<li><p><strong>Load balance:</strong> Event Processor based application consists of one or more instances of <code>EventProcessor</code> which have been
							configured to consume events from the same Event Hub and consumer group. They balance the
						workload across different instances by distributing the partitions to be processed among themselves.</p>
					</li>
					<li><p><strong>Checkpointing:</strong> It is a process by which readers mark or commit their position within a partition event sequence. Checkpointing is the responsibility of the consumer and
							occurs on a per-partition basis within a consumer group. This responsibility means that for each consumer group, each partition reader must keep track of its current position
						in the event stream, and can inform the service when it considers the data stream complete.</p>
						<p>If a reader disconnects from a partition, when it reconnects it begins reading at the checkpoint that was previously submitted by the last reader of that partition in that consumer group.
							When the reader connects, it passes the offset to the event hub to specify the location at which to start reading. In this way, you can use checkpointing to both mark events as &quot;complete&quot; by downstream applications,
							and to provide resiliency if a failover between readers running on different machines occurs. It is possible to return to older data by specifying a lower offset from this checkpointing process.
						Through this mechanism, checkpointing enables both failover resiliency and event stream replay.</p>
						<p>A <a href="https://azure.github.io/azure-sdk-for-js/eventhubs-checkpointstore-blob/classes/blobpartitionmanager.html">BlobPartitionManager</a> is a class that implements key methods required by the Event Processor to balance load and update checkpoints.</p>
					</li>
				</ul>
				<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
					<h2>Examples</h2>
				</a>
				<ul>
					<li><a href="#create-a-partition-manager-using-azure-blob-storage">Create a Partition Manager using Azure Blob Storage</a></li>
					<li><a href="#checkpoint-events-using-azure-blob-storage">Checkpoint events using Azure Blob storage</a></li>
				</ul>
				<a href="#create-a-partition-manager-using-azure-blob-storage" id="create-a-partition-manager-using-azure-blob-storage" style="color: inherit; text-decoration: none;">
					<h3>Create a Partition Manager using Azure Blob Storage</h3>
				</a>
				<p>Use the below code snippet to create a Partition Manager. You will need to provide the connection string to your storage account.</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { ContainerClient } <span class="hljs-keyword">from</span> <span class="hljs-string">"@azure/storage-blob"</span>,
<span class="hljs-keyword">import</span> { BlobPartitionManager } <span class="hljs-keyword">from</span> <span class="hljs-string">"@azure/eventhubs-checkpointstore-blob"</span>

<span class="hljs-keyword">const</span> containerClient = <span class="hljs-keyword">new</span> ContainerClient(<span class="hljs-string">"storage-connection-string"</span>, <span class="hljs-string">"container-name"</span>);
<span class="hljs-keyword">await</span> containerClient.create(); <span class="hljs-comment">// This can be skipped if the container already exists</span>

<span class="hljs-keyword">const</span> partitionManager =  <span class="hljs-keyword">new</span> BlobPartitionManager(containerClient);</code></pre>
				<a href="#checkpoint-events-using-azure-blob-storage" id="checkpoint-events-using-azure-blob-storage" style="color: inherit; text-decoration: none;">
					<h3>Checkpoint events using Azure Blob storage</h3>
				</a>
				<p>To checkpoint events received using an EventProcessor to Azure Blob Storage, you will need to pass an instance of the Partition Manager to the Event Processor along with the code to call the <code>updateCheckpoint()</code> method.</p>
				<p>In this example, we will use a <code>SamplePartitionProcessor</code> that extends the <a href="https://azure.github.io/azure-sdk-for-js/event-hubs/classes/partitionprocessor.html">PartitionProcessor</a> class in order to checkpoint the last event in the batch.</p>
				<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { ContainerClient } <span class="hljs-keyword">from</span> <span class="hljs-string">"@azure/storage-blob"</span>,
<span class="hljs-keyword">import</span> { BlobPartitionManager } <span class="hljs-keyword">from</span> <span class="hljs-string">"@azure/eventhubs-checkpointstore-blob"</span>
<span class="hljs-keyword">import</span> { EventHubClient, PartitionProcessor } <span class="hljs-keyword">from</span> <span class="hljs-string">"@azure/event-hubs"</span>

<span class="hljs-keyword">const</span> eventhubClient = <span class="hljs-keyword">new</span> EventHubClient(<span class="hljs-string">"event-hub-connectionstring"</span>)
<span class="hljs-keyword">const</span> containerClient = <span class="hljs-keyword">new</span> ContainerClient(<span class="hljs-string">"storage-connection-string"</span>, <span class="hljs-string">"container-name"</span>);
<span class="hljs-keyword">await</span> containerClient.create(); <span class="hljs-comment">// This can be skipped if the container already exists</span>
<span class="hljs-keyword">const</span> partitionManager =  <span class="hljs-keyword">new</span> BlobPartitionManager(containerClient);

SamplePartitionProcessor extends PartitionProcessor  {
  <span class="hljs-keyword">async</span> processEvents(events) {
    <span class="hljs-keyword">if</span> (events.length) {
     <span class="hljs-comment">/* custom logic for processing events, then checkpoint*/</span>
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.updateCheckpoint(events[events.length - <span class="hljs-number">1</span>]);
    } 
  }
}

<span class="hljs-keyword">const</span> eventProcessor = <span class="hljs-keyword">new</span> EventProcessor(
    EventHubClient.defaultConsumerGroupName,
    client,
    SamplePartitionProcessor,
    partitionManager);
eventProcessor.start();</code></pre>
				<a href="#troubleshooting" id="troubleshooting" style="color: inherit; text-decoration: none;">
					<h2>Troubleshooting</h2>
				</a>
				<a href="#enable-logs" id="enable-logs" style="color: inherit; text-decoration: none;">
					<h3>Enable logs</h3>
				</a>
				<p>You can set the following environment variable to get the debug logs when using this library.</p>
				<ul>
					<li>Getting debug logs from the Eventhubs Checkpointstore Blob</li>
				</ul>
				<pre><code class="language-bash"><span class="hljs-built_in">export</span> DEBUG=azure:eventhubs-checkpointstore-blob*</code></pre>
				<ul>
					<li>If you are interested only in <strong>errors</strong>, then you can set the <code>DEBUG</code> environment variable as follows:</li>
				</ul>
				<pre><code class="language-bash"><span class="hljs-built_in">export</span> DEBUG=azure:event-hubs:error,azure:eventhubs-checkpointstore-blob:error</code></pre>
				<a href="#logging-to-a-file" id="logging-to-a-file" style="color: inherit; text-decoration: none;">
					<h3>Logging to a file</h3>
				</a>
				<ul>
					<li><p>Set the <code>DEBUG</code> environment variable as shown above and then run your test script as follows:</p>
						<ul>
							<li><p>Logging statements from your test script go to <code>out.log</code> and logging statements from the sdk go to <code>debug.log</code>.</p>
								<pre><code class="language-bash">node your-test-script.js &gt; out.log 2&gt;debug.log</code></pre>
							</li>
							<li><p>Logging statements from your test script and the sdk go to the same file <code>out.log</code> by redirecting stderr to stdout (&amp;1), and then redirect stdout to a file:</p>
								<pre><code class="language-bash">node your-test-script.js &gt;out.log 2&gt;&amp;1</code></pre>
							</li>
							<li><p>Logging statements from your test script and the sdk go to the same file <code>out.log</code>.</p>
								<pre><code class="language-bash">  node your-test-script.js &amp;&gt; out.log</code></pre>
							</li>
						</ul>
					</li>
				</ul>
				<a href="#next-steps" id="next-steps" style="color: inherit; text-decoration: none;">
					<h2>Next Steps</h2>
				</a>
				<p>Please take a look at the <a href="https://github.com/Azure/azure-sdk-for-js/tree/master/sdk/eventhub/eventhubs-checkpointstore-blob/samples">samples</a>
				directory for detailed example.</p>
				<a href="#contributing" id="contributing" style="color: inherit; text-decoration: none;">
					<h2>Contributing</h2>
				</a>
				<p>If you&#39;d like to contribute to this library, please read the <a href="../../../CONTRIBUTING.md">contributing guide</a> to learn more about how to build and test the code.</p>
				<p><img src="https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js/sdk/eventhub/eventhubs-checkpointstore-blob/README.png" alt="Impressions"></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-class">
						<a href="classes/blobpartitionmanager.html" class="tsd-kind-icon">Blob<wbr>Partition<wbr>Manager</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>